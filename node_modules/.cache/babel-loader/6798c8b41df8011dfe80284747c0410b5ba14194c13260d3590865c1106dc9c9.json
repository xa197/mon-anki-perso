{"ast":null,"code":"import _objectSpread from\"/Users/xavier/mon-anki-perso/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';// On reçoit les cartes et les fonctions nécessaires du parent (App.js)\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ReviewView(_ref){let{navigateTo,allCards,onUpdateCards}=_ref;// --- ÉTATS DU COMPOSANT ---\nconst[dueCards,setDueCards]=useState([]);const[currentCardIndex,setCurrentCardIndex]=useState(0);const[isFlipped,setIsFlipped]=useState(false);const[currentItem,setCurrentItem]=useState('');// Pour le filtre\n// --- PRÉPARATION DES DONNÉES ---\nconst sortedItems=Array.from(new Set(allCards.map(c=>c.deck).filter(Boolean))).sort((a,b)=>parseInt(a.split(':')[0],10)-parseInt(b.split(':')[0],10));// --- EFFETS ---\n// Cet effet se déclenche quand les cartes ou le filtre changent.\n// Il calcule quelles cartes sont à réviser AUJOURD'HUI.\nuseEffect(()=>{const now=new Date();const cardsInScope=currentItem?allCards.filter(c=>c.deck===currentItem):allCards;const filteredDueCards=cardsInScope.filter(c=>new Date(c.nextReview)<=now);setDueCards(filteredDueCards);setCurrentCardIndex(0);// On réinitialise l'index à chaque changement\nsetIsFlipped(false);},[allCards,currentItem]);const currentCard=dueCards[currentCardIndex];// --- LOGIQUE MÉTIER ---\nconst handleFlip=()=>setIsFlipped(true);const handleDifficultyClick=quality=>{if(!currentCard)return;// Traduction de votre algorithme SM-2\nlet newInterval=currentCard.interval;let newEaseFactor=currentCard.easeFactor;if(quality<3){newInterval=1;}else{newInterval=newInterval===1?6:Math.round(newInterval*newEaseFactor);newEaseFactor+=0.1-(5-quality)*(0.08+(5-quality)*0.02);if(newEaseFactor<1.3)newEaseFactor=1.3;}const nextReviewDate=new Date();nextReviewDate.setDate(nextReviewDate.getDate()+newInterval);const updatedCard=_objectSpread(_objectSpread({},currentCard),{},{interval:newInterval,easeFactor:newEaseFactor,nextReview:nextReviewDate.toISOString()});// On met à jour la carte dans l'état global et on sauvegarde\nonUpdateCards(updatedCard);// On passe à la carte suivante\nhandleNextCard();};const handleNextCard=()=>{if(currentCardIndex<dueCards.length-1){setCurrentCardIndex(currentCardIndex+1);setIsFlipped(false);}else{// Si c'était la dernière carte, on force une fin de session\nsetDueCards([]);// Vide la liste pour afficher le message de fin\n}};// --- AFFICHAGE (RENDER) ---\nreturn/*#__PURE__*/_jsxs(\"div\",{id:\"review-view\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"review-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigateTo('home'),children:\"\\u2190 Accueil\"}),/*#__PURE__*/_jsxs(\"div\",{id:\"item-selector-container\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"item-input\",children:\"Filtrer par Item :\"}),/*#__PURE__*/_jsxs(\"select\",{value:currentItem,onChange:e=>setCurrentItem(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Tous les items --\"}),sortedItems.map(item=>/*#__PURE__*/_jsx(\"option\",{value:item,children:item},item))]})]})]}),currentCard?/*#__PURE__*/_jsxs(\"div\",{id:\"app\",children:[/*#__PURE__*/_jsxs(\"div\",{id:\"card-container\",className:\"card \".concat(isFlipped?'is-flipped':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-face card-front\",onClick:handleFlip,children:/*#__PURE__*/_jsx(\"p\",{children:currentCard.recto})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-face card-back\",children:/*#__PURE__*/_jsx(\"p\",{children:currentCard.verso})})]}),/*#__PURE__*/_jsx(\"div\",{id:\"controls\",children:!isFlipped?/*#__PURE__*/_jsx(\"button\",{id:\"show-answer-btn\",onClick:handleFlip,children:\"Voir la r\\xE9ponse\"}):/*#__PURE__*/_jsxs(\"div\",{id:\"difficulty-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"difficulty-btn\",onClick:()=>handleDifficultyClick(1),children:\"\\xC0 revoir\"}),/*#__PURE__*/_jsx(\"button\",{className:\"difficulty-btn\",onClick:()=>handleDifficultyClick(3),children:\"Difficile\"}),/*#__PURE__*/_jsx(\"button\",{className:\"difficulty-btn\",onClick:()=>handleDifficultyClick(4),children:\"Correct\"}),/*#__PURE__*/_jsx(\"button\",{className:\"difficulty-btn\",onClick:()=>handleDifficultyClick(5),children:\"Facile\"})]})})]}):/*#__PURE__*/// Message si aucune carte n'est à réviser\n_jsxs(\"div\",{style:{textAlign:'center',padding:'50px 0'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83C\\uDF89 Bravo !\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Aucune carte \\xE0 r\\xE9viser pour le moment.\"})]})]});}export default ReviewView;","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","jsxs","_jsxs","ReviewView","_ref","navigateTo","allCards","onUpdateCards","dueCards","setDueCards","currentCardIndex","setCurrentCardIndex","isFlipped","setIsFlipped","currentItem","setCurrentItem","sortedItems","Array","from","Set","map","c","deck","filter","Boolean","sort","a","b","parseInt","split","now","Date","cardsInScope","filteredDueCards","nextReview","currentCard","handleFlip","handleDifficultyClick","quality","newInterval","interval","newEaseFactor","easeFactor","Math","round","nextReviewDate","setDate","getDate","updatedCard","_objectSpread","toISOString","handleNextCard","length","id","children","className","onClick","htmlFor","value","onChange","e","target","item","concat","recto","verso","style","textAlign","padding"],"sources":["/Users/xavier/mon-anki-perso/src/components/ReviewView.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\n// On reçoit les cartes et les fonctions nécessaires du parent (App.js)\nfunction ReviewView({ navigateTo, allCards, onUpdateCards }) {\n  // --- ÉTATS DU COMPOSANT ---\n  const [dueCards, setDueCards] = useState([]);\n  const [currentCardIndex, setCurrentCardIndex] = useState(0);\n  const [isFlipped, setIsFlipped] = useState(false);\n  const [currentItem, setCurrentItem] = useState(''); // Pour le filtre\n\n  // --- PRÉPARATION DES DONNÉES ---\n  const sortedItems = Array.from(new Set(allCards.map(c => c.deck).filter(Boolean)))\n    .sort((a, b) => parseInt(a.split(':')[0], 10) - parseInt(b.split(':')[0], 10));\n\n  // --- EFFETS ---\n  // Cet effet se déclenche quand les cartes ou le filtre changent.\n  // Il calcule quelles cartes sont à réviser AUJOURD'HUI.\n  useEffect(() => {\n    const now = new Date();\n    const cardsInScope = currentItem ? allCards.filter(c => c.deck === currentItem) : allCards;\n    const filteredDueCards = cardsInScope.filter(c => new Date(c.nextReview) <= now);\n    \n    setDueCards(filteredDueCards);\n    setCurrentCardIndex(0); // On réinitialise l'index à chaque changement\n    setIsFlipped(false);\n  }, [allCards, currentItem]);\n\n  const currentCard = dueCards[currentCardIndex];\n\n  // --- LOGIQUE MÉTIER ---\n  const handleFlip = () => setIsFlipped(true);\n\n  const handleDifficultyClick = (quality) => {\n    if (!currentCard) return;\n\n    // Traduction de votre algorithme SM-2\n    let newInterval = currentCard.interval;\n    let newEaseFactor = currentCard.easeFactor;\n\n    if (quality < 3) {\n      newInterval = 1;\n    } else {\n      newInterval = (newInterval === 1) ? 6 : Math.round(newInterval * newEaseFactor);\n      newEaseFactor += (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));\n      if (newEaseFactor < 1.3) newEaseFactor = 1.3;\n    }\n\n    const nextReviewDate = new Date();\n    nextReviewDate.setDate(nextReviewDate.getDate() + newInterval);\n\n    const updatedCard = {\n      ...currentCard,\n      interval: newInterval,\n      easeFactor: newEaseFactor,\n      nextReview: nextReviewDate.toISOString(),\n    };\n\n    // On met à jour la carte dans l'état global et on sauvegarde\n    onUpdateCards(updatedCard);\n\n    // On passe à la carte suivante\n    handleNextCard();\n  };\n\n  const handleNextCard = () => {\n    if (currentCardIndex < dueCards.length - 1) {\n      setCurrentCardIndex(currentCardIndex + 1);\n      setIsFlipped(false);\n    } else {\n      // Si c'était la dernière carte, on force une fin de session\n      setDueCards([]); // Vide la liste pour afficher le message de fin\n    }\n  };\n\n\n  // --- AFFICHAGE (RENDER) ---\n  return (\n    <div id=\"review-view\">\n      <div className=\"review-header\">\n        <button onClick={() => navigateTo('home')}>← Accueil</button>\n        <div id=\"item-selector-container\">\n          <label htmlFor=\"item-input\">Filtrer par Item :</label>\n          <select value={currentItem} onChange={(e) => setCurrentItem(e.target.value)}>\n            <option value=\"\">-- Tous les items --</option>\n            {sortedItems.map(item => <option key={item} value={item}>{item}</option>)}\n          </select>\n        </div>\n      </div>\n\n      {/* On affiche la carte seulement s'il y en a à réviser */}\n      {currentCard ? (\n        <div id=\"app\">\n          <div id=\"card-container\" className={`card ${isFlipped ? 'is-flipped' : ''}`}>\n            <div className=\"card-face card-front\" onClick={handleFlip}>\n              <p>{currentCard.recto}</p>\n            </div>\n            <div className=\"card-face card-back\">\n              <p>{currentCard.verso}</p>\n            </div>\n          </div>\n\n          <div id=\"controls\">\n            {!isFlipped ? (\n              <button id=\"show-answer-btn\" onClick={handleFlip}>Voir la réponse</button>\n            ) : (\n              <div id=\"difficulty-buttons\">\n                <button className=\"difficulty-btn\" onClick={() => handleDifficultyClick(1)}>À revoir</button>\n                <button className=\"difficulty-btn\" onClick={() => handleDifficultyClick(3)}>Difficile</button>\n                <button className=\"difficulty-btn\" onClick={() => handleDifficultyClick(4)}>Correct</button>\n                <button className=\"difficulty-btn\" onClick={() => handleDifficultyClick(5)}>Facile</button>\n              </div>\n            )}\n          </div>\n        </div>\n      ) : (\n        // Message si aucune carte n'est à réviser\n        <div style={{ textAlign: 'center', padding: '50px 0' }}>\n          <h2>🎉 Bravo !</h2>\n          <p>Aucune carte à réviser pour le moment.</p>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default ReviewView;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}