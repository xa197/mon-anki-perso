{"ast":null,"code":"import _objectSpread from\"/Users/xavier/mon-anki-perso/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function ReviewView(_ref){let{navigateTo,allCards,onUpdateCards}=_ref;const[dueCards,setDueCards]=useState([]);const[currentCardIndex,setCurrentCardIndex]=useState(0);const[isFlipped,setIsFlipped]=useState(false);const[currentItem,setCurrentItem]=useState('');const sortedItems=Array.from(new Set(allCards.map(c=>c.deck).filter(Boolean))).sort((a,b)=>parseInt(a.split(':')[0],10)-parseInt(b.split(':')[0],10));useEffect(()=>{const now=new Date();// On s'assure que allCards est bien un tableau avant de filtrer\nconst cardsToFilter=Array.isArray(allCards)?allCards:[];const cardsInScope=currentItem?cardsToFilter.filter(c=>c.deck===currentItem):cardsToFilter;const filteredDueCards=cardsInScope.filter(c=>new Date(c.nextReview)<=now);setDueCards(filteredDueCards);setCurrentCardIndex(0);setIsFlipped(false);},[allCards,currentItem]);const currentCard=dueCards[currentCardIndex];const handleFlip=()=>setIsFlipped(true);const handleDifficultyClick=quality=>{if(!currentCard)return;let newInterval=currentCard.interval;let newEaseFactor=currentCard.easeFactor;if(quality<3){newInterval=1;}else{newInterval=newInterval===1?6:Math.round(newInterval*newEaseFactor);newEaseFactor+=0.1-(5-quality)*(0.08+(5-quality)*0.02);if(newEaseFactor<1.3)newEaseFactor=1.3;}const nextReviewDate=new Date();nextReviewDate.setDate(nextReviewDate.getDate()+newInterval);const updatedCard=_objectSpread(_objectSpread({},currentCard),{},{interval:newInterval,easeFactor:newEaseFactor,nextReview:nextReviewDate.toISOString()});onUpdateCards(updatedCard);// On passe √† la carte suivante\nif(currentCardIndex<dueCards.length-1){setCurrentCardIndex(currentCardIndex+1);setIsFlipped(false);}else{// Si c'√©tait la derni√®re carte, on force un \"recalcul\" en vidant la liste temporairement\nsetDueCards([]);}};return/*#__PURE__*/_jsxs(\"div\",{id:\"review-view\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"review-header\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigateTo('home'),children:\"\\u2190 Accueil\"}),/*#__PURE__*/_jsxs(\"div\",{id:\"item-selector-container\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"item-input\",children:\"Filtrer par Item :\"}),/*#__PURE__*/_jsxs(\"select\",{value:currentItem,onChange:e=>setCurrentItem(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Tous les items --\"}),sortedItems.map(item=>/*#__PURE__*/_jsx(\"option\",{value:item,children:item},item))]})]})]}),currentCard?/*#__PURE__*/_jsxs(\"div\",{id:\"app\",children:[/*#__PURE__*/_jsxs(\"div\",{id:\"card-container\",className:\"card \".concat(isFlipped?'is-flipped':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-face card-front\",onClick:handleFlip,children:/*#__PURE__*/_jsx(\"p\",{children:currentCard.recto})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-face card-back\",children:/*#__PURE__*/_jsx(\"p\",{children:currentCard.verso})})]}),/*#__PURE__*/_jsx(\"div\",{id:\"controls\",children:!isFlipped?/*#__PURE__*/_jsx(\"button\",{id:\"show-answer-btn\",onClick:handleFlip,children:\"Voir la r\\xE9ponse\"}):/*#__PURE__*/_jsxs(\"div\",{id:\"difficulty-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"difficulty-btn\",onClick:()=>handleDifficultyClick(1),children:\"\\xC0 revoir\"}),/*#__PURE__*/_jsx(\"button\",{className:\"difficulty-btn\",onClick:()=>handleDifficultyClick(3),children:\"Difficile\"}),/*#__PURE__*/_jsx(\"button\",{className:\"difficulty-btn\",onClick:()=>handleDifficultyClick(4),children:\"Correct\"}),/*#__PURE__*/_jsx(\"button\",{className:\"difficulty-btn\",onClick:()=>handleDifficultyClick(5),children:\"Facile\"})]})})]}):/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'50px 0'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83C\\uDF89 Bravo !\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Aucune carte \\xE0 r\\xE9viser pour le moment.\"})]})]});}export default ReviewView;","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","jsxs","_jsxs","ReviewView","_ref","navigateTo","allCards","onUpdateCards","dueCards","setDueCards","currentCardIndex","setCurrentCardIndex","isFlipped","setIsFlipped","currentItem","setCurrentItem","sortedItems","Array","from","Set","map","c","deck","filter","Boolean","sort","a","b","parseInt","split","now","Date","cardsToFilter","isArray","cardsInScope","filteredDueCards","nextReview","currentCard","handleFlip","handleDifficultyClick","quality","newInterval","interval","newEaseFactor","easeFactor","Math","round","nextReviewDate","setDate","getDate","updatedCard","_objectSpread","toISOString","length","id","children","className","onClick","htmlFor","value","onChange","e","target","item","concat","recto","verso","style","textAlign","padding"],"sources":["/Users/xavier/mon-anki-perso/src/components/ReviewView.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\nfunction ReviewView({ navigateTo, allCards, onUpdateCards }) {\n  const [dueCards, setDueCards] = useState([]);\n  const [currentCardIndex, setCurrentCardIndex] = useState(0);\n  const [isFlipped, setIsFlipped] = useState(false);\n  const [currentItem, setCurrentItem] = useState('');\n\n  const sortedItems = Array.from(new Set(allCards.map(c => c.deck).filter(Boolean)))\n    .sort((a, b) => parseInt(a.split(':')[0], 10) - parseInt(b.split(':')[0], 10));\n\n  useEffect(() => {\n    const now = new Date();\n    // On s'assure que allCards est bien un tableau avant de filtrer\n    const cardsToFilter = Array.isArray(allCards) ? allCards : [];\n    const cardsInScope = currentItem ? cardsToFilter.filter(c => c.deck === currentItem) : cardsToFilter;\n    const filteredDueCards = cardsInScope.filter(c => new Date(c.nextReview) <= now);\n    \n    setDueCards(filteredDueCards);\n    setCurrentCardIndex(0);\n    setIsFlipped(false);\n  }, [allCards, currentItem]);\n\n  const currentCard = dueCards[currentCardIndex];\n\n  const handleFlip = () => setIsFlipped(true);\n\n  const handleDifficultyClick = (quality) => {\n    if (!currentCard) return;\n\n    let newInterval = currentCard.interval;\n    let newEaseFactor = currentCard.easeFactor;\n\n    if (quality < 3) {\n      newInterval = 1;\n    } else {\n      newInterval = (newInterval === 1) ? 6 : Math.round(newInterval * newEaseFactor);\n      newEaseFactor += (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));\n      if (newEaseFactor < 1.3) newEaseFactor = 1.3;\n    }\n\n    const nextReviewDate = new Date();\n    nextReviewDate.setDate(nextReviewDate.getDate() + newInterval);\n\n    const updatedCard = { ...currentCard, interval: newInterval, easeFactor: newEaseFactor, nextReview: nextReviewDate.toISOString() };\n\n    onUpdateCards(updatedCard);\n\n    // On passe √† la carte suivante\n    if (currentCardIndex < dueCards.length - 1) {\n      setCurrentCardIndex(currentCardIndex + 1);\n      setIsFlipped(false);\n    } else {\n      // Si c'√©tait la derni√®re carte, on force un \"recalcul\" en vidant la liste temporairement\n      setDueCards([]);\n    }\n  };\n\n  return (\n    <div id=\"review-view\">\n      <div className=\"review-header\">\n        <button onClick={() => navigateTo('home')}>‚Üê Accueil</button>\n        <div id=\"item-selector-container\">\n          <label htmlFor=\"item-input\">Filtrer par Item :</label>\n          <select value={currentItem} onChange={(e) => setCurrentItem(e.target.value)}>\n            <option value=\"\">-- Tous les items --</option>\n            {sortedItems.map(item => <option key={item} value={item}>{item}</option>)}\n          </select>\n        </div>\n      </div>\n\n      {currentCard ? (\n        <div id=\"app\">\n          <div id=\"card-container\" className={`card ${isFlipped ? 'is-flipped' : ''}`}>\n            <div className=\"card-face card-front\" onClick={handleFlip}>\n              <p>{currentCard.recto}</p>\n            </div>\n            <div className=\"card-face card-back\">\n              <p>{currentCard.verso}</p>\n            </div>\n          </div>\n          <div id=\"controls\">\n            {!isFlipped ? (\n              <button id=\"show-answer-btn\" onClick={handleFlip}>Voir la r√©ponse</button>\n            ) : (\n              <div id=\"difficulty-buttons\">\n                <button className=\"difficulty-btn\" onClick={() => handleDifficultyClick(1)}>√Ä revoir</button>\n                <button className=\"difficulty-btn\" onClick={() => handleDifficultyClick(3)}>Difficile</button>\n                <button className=\"difficulty-btn\" onClick={() => handleDifficultyClick(4)}>Correct</button>\n                <button className=\"difficulty-btn\" onClick={() => handleDifficultyClick(5)}>Facile</button>\n              </div>\n            )}\n          </div>\n        </div>\n      ) : (\n        <div style={{ textAlign: 'center', padding: '50px 0' }}>\n          <h2>üéâ Bravo !</h2>\n          <p>Aucune carte √† r√©viser pour le moment.</p>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default ReviewView;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}